{% if parameter.IsDateTimeArray -%}
foreach (var item in {{ parameter.VariableName }}) { urlBuilder.Append(Uri.EscapeDataString("{{ parameter.Name }}")).Append('=').Append(Uri.EscapeDataString(item.ToString("{{ ParameterDateTimeFormat }}", CultureInfo.InvariantCulture))).Append('&'); }
{% elsif parameter.IsDateArray -%}
foreach (var item in {{ parameter.VariableName }}) { urlBuilder.Append(Uri.EscapeDataString("{{ parameter.Name }}")).Append('=').Append(Uri.EscapeDataString(item.ToString("{{ ParameterDateFormat }}", CultureInfo.InvariantCulture))).Append('&'); }
{% elsif parameter.IsDateTime -%}
urlBuilder.Append(Uri.EscapeDataString("{{ parameter.Name }}")).Append('=').Append(Uri.EscapeDataString({% if parameter.IsNullable and parameter.IsRequired %}{{ parameter.VariableName }} != null ? {% endif %}{{ parameter.VariableName }}{% if parameter.IsSystemNullable %}.Value{% endif %}.ToString("{{ ParameterDateTimeFormat }}", CultureInfo.InvariantCulture){% if parameter.IsNullable and parameter.IsRequired %} : "{{ QueryNullValue }}"{% endif %})).Append('&');
{% elsif parameter.IsDate -%}
urlBuilder.Append(Uri.EscapeDataString("{{ parameter.Name }}")).Append('=').Append(Uri.EscapeDataString({% if parameter.IsNullable and parameter.IsRequired %}{{ parameter.VariableName }} != null ? {% endif %}{{ parameter.VariableName }}{% if parameter.IsSystemNullable %}.Value{% endif %}.ToString("{{ ParameterDateFormat }}", CultureInfo.InvariantCulture){% if parameter.IsNullable and parameter.IsRequired %} : "{{ QueryNullValue }}"{% endif %})).Append('&');
{% elsif parameter.IsArray -%}
foreach (var item in {{ parameter.VariableName }}) { urlBuilder.Append(Uri.EscapeDataString("{{ parameter.Name }}")).Append('=').Append(Uri.EscapeDataString(ConvertToString(item, CultureInfo.InvariantCulture))).Append('&'); }
{% elsif parameter.IsDictionary -%}
foreach (var item in {{ parameter.VariableName }}) { urlBuilder.Append(Uri.EscapeDataString(item.Key)).Append('=').Append(Uri.EscapeDataString(ConvertToString(item.Value, CultureInfo.InvariantCulture))).Append('&'); }
{% elsif parameter.IsDeepObject -%}
{%     for property in parameter.PropertyNames -%}
if ({{parameter.Name}}.{{property.Name}} != null)
{
    urlBuilder.Append(Uri.EscapeDataString("{{parameter.Name}}[{{property.Key}}]")).Append('=').Append(Uri.EscapeDataString(ConvertToString({{parameter.Name}}.{{property.Name}}, CultureInfo.InvariantCulture))).Append('&');
}
{%     endfor -%}
{%     for property in parameter.CollectionPropertyNames -%}
if ({{parameter.Name}}.{{property.Name}} != null && {{parameter.Name}}.{{property.Name}}.Count > 0)
{
    urlBuilder.Append(Uri.EscapeDataString("{{parameter.Name}}[{{property.Key}}]")).Append('=');
    foreach (var p_ in {{parameter.Name}}.{{property.Name}})
    {
        urlBuilder.Append(Uri.EscapeDataString(ConvertToString(p_, CultureInfo.InvariantCulture))).Append(',');
    }
    urlBuilder.Length--;
    urlBuilder.Append('&');
}
{%     endfor -%}
{% elsif parameter.Explode and parameter.IsForm and parameter.IsObject -%}
{%     for property in parameter.PropertyNames -%}
if ({{parameter.Name}}.{{property.Name}} != null)
{
    urlBuilder.Append(Uri.EscapeDataString("{{property.Key}}")).Append('=').Append(Uri.EscapeDataString(ConvertToString({{parameter.Name}}.{{property.Name}}, CultureInfo.InvariantCulture))).Append('&');
}
{%     endfor -%}
{% elsif parameter.HasAdditionalProperties == false -%}
urlBuilder.Append(Uri.EscapeDataString("{{ parameter.Name }}")).Append('=').Append(Uri.EscapeDataString({% if parameter.IsNullable and parameter.IsRequired %}{{ parameter.VariableName }} != null ? {% endif %}ConvertToString({{ parameter.VariableName }}, CultureInfo.InvariantCulture){% if parameter.IsNullable and parameter.IsRequired %} : "{{ QueryNullValue }}"{% endif %})).Append('&');
{% endif -%}
{% if parameter.HasAdditionalProperties -%}
foreach (var item in {{parameter.Name}}.AdditionalProperties) { urlBuilder.Append(Uri.EscapeDataString(item.Key)).Append('=').Append(Uri.EscapeDataString(ConvertToString(item.Value, CultureInfo.InvariantCulture))).Append('&'); }
{% endif -%}
